---
key: 20190427
title: 公有云上信封加密与密钥管理实践
tags: DigitalEnvelope KMS(KeyManagementSystem)
---

## 信封加密原理

信封加密使用对称加密AES+非对称加密RSA两种实现，使用RSA加密AES算法的Key，并将Key与一并存储或传输，密文+加密的AES Key就形象比喻为信封。

信封加密用于加密大量数据的场景，由于RSA加密的长度不允许超过RSA Key长度，因此对于大文件加密的场景，如图片/视频/文本等，需要使用对称加密算法。对称加密算法的Key在网路或组织之间传输存在泄露风险，因此使用RSA非对称算法加密对称密钥的Key，可以保证Key的安全传输。 <!--more-->

信封加密实际上在SSL协议中就有使用，SSL协议在交换公钥之后，最终会协商一个AES加密的Key，这个Key在双方使用RSA加密的。

信封加密的加密示意
![](https://sixscape.com/wp-content/uploads/2015/03/DE.png)

信封加密的解密示意
![](https://sixscape.com/wp-content/uploads/2015/03/DE1.png)


## 公有云 KMS 服务

信封加密的关键是加密对称密钥的RSA Key，RSA Key需要主密钥管理、数据加密密钥管理、有访问控制、访问审计日志、Key轮换更新的功能。
当前各大公有云厂商都提供密钥管理服务，并且与云服务器对接集成，如对象存储服务可以使用KMS加密数据，RDS可以使用KMS加密硬盘数据。

- 主密钥管理：创建新的主密钥、从已有密钥导入到KMS、主密钥轮换更新（加密的数据密钥中记录了使用哪个主密钥加密，主密钥轮换更新后之前的密钥还存在）、密钥访问控制、访问审计日志。
- 数据加密密钥管理：创建、加密、解密。
- 云服务对接：对象存储、云硬盘、数据库等。

## Reference

[PKCS#1 V2](https://www.emc.com/collateral/white-papers/h11300-pkcs-1v2-2-rsa-cryptography-standard-wp.pdf)

[RAS算法原理一](http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html)

[RAS算法原理二](http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html)

[RSA加密演算法](https://zh.wikipedia.org/wiki/RSA%E5%8A%A0%E5%AF%86%E6%BC%94%E7%AE%97%E6%B3%95)